<routes xmlns="http://camel.apache.org/schema/spring">
  <route id="select">
    <from uri="direct:sync"/>
    <to uri="log:log"/>
    <toD uri="openmrs:extract?tableToSync=${body.getTableToSync().name()}&amp;lastSyncDate=${body.getLastSyncDateAsString()}"/>
    <!--Authentifaction to Odoo and register token to-->
    <enrich strategyRef="setOdooTokenToHeaderAggregationStrategy">
      <constant>{{odoo.url}}/api/auth/token?login={{odoo.username}}&amp;password={{odoo.password}}&amp;db={{odoo.database}}</constant>
    </enrich>
    <split streaming="true">
      <jsonpath writeAsString="true">$</jsonpath>
      <!--<process ref="pgpEncryptService"/>-->
      <to uri="{{camel.output.endpoint}}"/>
    </split>
    <process ref="saveSyncStatusProcessor"/>
  </route>
</routes>
