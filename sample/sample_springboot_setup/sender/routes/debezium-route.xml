<routes xmlns="http://camel.apache.org/schema/spring">
    <route id="debezium">
        <from uri="debezium-mysql:extract?databaseServerId={{debezium.db.serverId}}&amp;databaseServerName={{debezium.db.serverName}}&amp;databaseHostname={{debezium.db.host}}
&amp;databasePort={{debezium.db.port}}&amp;databaseUser={{debezium.db.user}}&amp;databasePassword={{debezium.db.password}}&amp;databaseWhitelist={{debezium.db.name}}
&amp;offsetStorageFileName={{debezium.offsetFilename}}&amp;databaseHistoryFileFilename={{debezium.historyFilename}}
&amp;tableWhitelist={{debezium.tablesToSync}}&amp;offsetFlushIntervalMs=0&amp;snapshotMode=schema_only" />

        <log message="Received DB change event: Operation=${headers.CamelDebeziumOperation}, ${body}, Metadata=${headers.CamelDebeziumSourceMetadata}" />

        <when>
            <simple>${headers.CamelDebeziumOperation} == 'c' || ${headers.CamelDebeziumOperation} == 'u' || ${headers.CamelDebeziumOperation} == 'd'</simple>
            <setBody>
                <spel>
                    #{new org.openmrs.sync.component.entity.SyncRecord(body.get('uuid'), request.headers.CamelDebeziumSourceMetadata.get('table'), request.headers.CamelDebeziumOperation)}
                </spel>
            </setBody>

            <to uri="direct:publish-sync-record-route" />
        </when>
        
    </route>
</routes>
